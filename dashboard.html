<canvas id="impactoChart" aria-label="Gráfico de materiais reciclados" role="img"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const ctx = document.getElementById('impactoChart');
    
    if (!ctx) return;
    
    try {
      // Carrega dados dinamicamente
      const response = await fetch('/api/reciclagem');
      const chartData = await response.json();
      
      renderChart(ctx, chartData);
    } catch (error) {
      console.error("Erro:", error);
      showFallbackMessage();
    }
  });

  function renderChart(ctx, data) {
    return new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.labels || ['Plástico', 'Vidro', 'Eletrônico'],
        datasets: [{
          label: 'kg Reciclados',
          data: data.values || [12, 8, 5],
          backgroundColor: [
            '#2E8B57', '#3498DB', '#E74C3C'
          ],
          borderWidth: 1
        }]
      },
      options: getChartOptions()
    });
  }

  function getChartOptions() {
    return {
      responsive: true,
      plugins: {
        legend: { display: true },
        tooltip: {
          callbacks: {
            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw}kg`
          }
        }
      },
      scales: { y: { beginAtZero: true } }
    };
  }

  function showFallbackMessage() {
    const container = document.querySelector('#impactoChart').parentElement;
    container.innerHTML = '<p>Não foi possível carregar o gráfico. Os dados de reciclagem estão disponíveis na tabela abaixo.</p>';
  }
</script>